<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NUSATASK ‚Äî Premium Earning</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9779635' data-sdk='show_9779635'></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{--bg:#06070a;--card:#0f1720;--accent1:#6ee7b7;--accent2:#60a5fa}
    body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#020305,#0b1220);color:#f1f8ff;min-height:100vh}
    .center{display:flex;align-items:center;justify-content:center}

    /* Loading */
    #loading{height:100vh;flex-direction:column;gap:18px}
    .logo{width:80px;height:80px;border-radius:20px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;color:#021;box-shadow:0 10px 40px rgba(0,200,255,.15)}
    .loadingBar{width:260px;height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .fill{width:0;height:100%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .8s}

    /* Auth */
    .authCard{max-width:360px;margin:60px auto;padding:24px;background:rgba(255,255,255,.03);border-radius:16px}
    input{width:100%;padding:12px;margin:6px 0;border:0;border-radius:10px;background:rgba(255,255,255,.07);color:#fff}
    .btn{padding:12px 18px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border:0;font-weight:600;cursor:pointer;color:#012}

    /* Warning */
    .warnBox{max-width:420px;padding:20px;border-radius:14px;background:#141b29}

    /* App */
    .appWrap{max-width:900px;margin:30px auto;padding:20px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .balance{padding:10px 16px;background:rgba(255,255,255,.05);border-radius:12px;font-weight:700}
    .card{background:rgba(255,255,255,.03);padding:24px;border-radius:16px;margin-top:20px;text-align:center}
    .earnBtn{padding:16px 32px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border:0;font-weight:700;color:#012;cursor:pointer}
    .earnBtn[disabled]{opacity:.5;cursor:not-allowed}
    .progress{height:12px;background:rgba(255,255,255,.07);border-radius:999px;margin-top:14px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .3s}

    /* Notif modal */
    .notif{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999}
    .notifBox{background:#10141d;padding:22px;border-radius:16px;max-width:320px;text-align:center}
    .notifTitle{font-weight:700;font-size:18px;margin-bottom:6px}
    .notifMsg{font-size:14px;color:#bbb;margin-bottom:14px}
    .notifBtn{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:0;padding:10px 16px;border-radius:999px;font-weight:600;color:#012;cursor:pointer}
  </style>
</head>
<body>

<!-- Loading -->
<div id="loading" class="center" style="flex-direction:column">
  <div class="logo">NT</div>
  <h2>NUSATASK</h2>
  <div class="loadingBar"><div id="fill" class="fill"></div></div>
</div>

<!-- Auth -->
<div id="auth" style="display:none">
  <div class="authCard">
    <h2>Masuk / Daftar</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password (min 6)">
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
      <button class="btn" id="btn-login">Login</button>
      <button class="btn" id="btn-register">Daftar</button>
    </div>
  </div>
</div>

<!-- Warning -->
<div id="warning" class="center" style="display:none">
  <div class="warnBox">
    <h3>‚ö†Ô∏è Peringatan</h3>
    <p style="font-size:14px;color:#ccc">Segala bentuk hack / nuyul / manipulasi data akan mengakibatkan banned otomatis.</p>
    <button id="continueBtn" class="btn" disabled>Continue (5)</button>
  </div>
</div>

<!-- App -->
<div id="app" style="display:none">
  <div class="appWrap">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo" style="width:56px;height:56px;font-size:20px">NT</div>
        <div><div style="font-weight:700">NUSATASK</div><div style="font-size:13px;color:#999">Premium earning</div></div>
      </div>
      <div class="balance">üí∞ <span id="balance">0</span></div>
    </div>

    <div class="card">
      <p style="font-size:14px;color:#aaa">Tonton iklan Monetag. Cooldown 3 menit | Max 20x / hari</p>
      <button class="earnBtn" id="earnBtn">MENGHASILKAN</button>
      <div class="progress"><div id="progBar" class="bar"></div></div>
      <div id="statusText" style="font-size:13px;color:#aaa;margin-top:6px">Sisa: 20 / hari</div>
    </div>
  </div>
</div>

<!-- Notif -->
<div id="notif" class="notif">
  <div class="notifBox">
    <div id="notifTitle" class="notifTitle">Info</div>
    <div id="notifMsg" class="notifMsg">Pesan</div>
    <button class="notifBtn" onclick="closeNotif()">OK</button>
  </div>
</div>

<script>
/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDdlvPMWThdEUk2D92Tg_mQSHbGO4LG2AE",
  authDomain: "nusa-7a52a.firebaseapp.com",
  databaseURL: "https://nusa-7a52a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "nusa-7a52a",
  storageBucket: "nusa-7a52a.firebasestorage.app",
  messagingSenderId: "72016839114",
  appId: "1:72016839114:web:0bc8978a826619f7ad8f33",
  measurementId: "G-HBZN4WGKWX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(), db = firebase.firestore();

/* Const */
const COOLDOWN_MS = 180000, DAILY_MAX = 20, REWARD = 10;
const deviceId = btoa(navigator.userAgent+screen.width+screen.height);
let userIp = "";
fetch("https://api.ipify.org?format=json").then(r=>r.json()).then(j=>userIp=j.ip);

/* Loading */
setTimeout(()=>document.getElementById("fill").style.width="100%",400);
setTimeout(()=>{document.getElementById("loading").style.display="none";document.getElementById("auth").style.display="block"},1200);

/* Notif */
function showNotif(t,m){document.getElementById("notifTitle").innerText=t;document.getElementById("notifMsg").innerText=m;document.getElementById("notif").style.display="flex"}
function closeNotif(){document.getElementById("notif").style.display="none"}

/* Register */
document.getElementById("btn-register").onclick=async()=>{
  try{
    const e=email.value,p=password.value;
    if(!e||p.length<6) return showNotif("‚ùå Error","Email & password minimal 6 karakter");
    const cred=await auth.createUserWithEmailAndPassword(e,p);
    await db.collection("users").doc(cred.user.uid).set({balance:0,dailyCount:0,lastUsed:null,deviceId,ip:userIp,banned:false});
    showWarning();
  }catch(err){showNotif("‚ùå Error",err.message)}
};
/* Login */
document.getElementById("btn-login").onclick=async()=>{
  try{
    const cred=await auth.signInWithEmailAndPassword(email.value,password.value);
    const doc=await db.collection("users").doc(cred.user.uid).get();
    if(!doc.exists) return showNotif("‚ö†Ô∏è Error","User belum register");
    showWarning();
  }catch(err){showNotif("‚ùå Error",err.message)}
};

/* Warning */
function showWarning(){
  auth.style.display="none";warning.style.display="flex";
  let t=5;const btn=continueBtn;btn.disabled=true;btn.innerText=`Continue (${t})`;
  let iv=setInterval(()=>{t--;btn.innerText=t>0?`Continue (${t})`:"Continue";if(t<=0){clearInterval(iv);btn.disabled=false}},1000);
  btn.onclick=()=>{warning.style.display="none";showApp()};
}

/* Dashboard */
function showApp(){
  app.style.display="block";
  const uid=auth.currentUser.uid,ref=db.collection("users").doc(uid);
  checkSecurity(ref);
  ref.onSnapshot(s=>{
    if(!s.exists)return;
    const d=s.data();
    if(d.banned){showNotif("üö´ Banned","Akun diblokir: "+(d.reason||""));auth.signOut();return;}
    balance.innerText=d.balance||0;
    progBar.style.width=((d.dailyCount||0)/DAILY_MAX*100)+"%";
    statusText.innerText=`Sisa: ${Math.max(0,DAILY_MAX-(d.dailyCount||0))} / hari`;
    if(d.lastUsed){const rem=COOLDOWN_MS-(Date.now()-d.lastUsed.toMillis());if(rem>0){earnBtn.disabled=true;earnBtn.innerText=`Cooldown ${Math.ceil(rem/1000)}s`;return;}}
    earnBtn.disabled=false;earnBtn.innerText="MENGHASILKAN";
  });
  earnBtn.onclick=()=>claim(ref);
}

/* Claim Reward */
async function claim(ref){
  try{
    await db.runTransaction(async t=>{
      const doc=await t.get(ref);if(!doc.exists)throw"User not found";
      const d=doc.data();if(d.banned)throw"Akun dibanned";
      const now=firebase.firestore.Timestamp.now();
      if(d.lastUsed && now.seconds-d.lastUsed.seconds<COOLDOWN_MS/1000)throw"Cooldown aktif";
      if((d.dailyCount||0)>=DAILY_MAX)throw"Kuota harian habis";
      await show_9779635(); // Monetag ad
      t.update(ref,{balance:(d.balance||0)+REWARD,dailyCount:(d.dailyCount||0)+1,lastUsed:now,deviceId,ip:userIp});
    });
    showNotif("‚úÖ Berhasil","+10 poin ditambahkan");
  }catch(err){showNotif("‚ùå Gagal",err)}
}

/* Security */
async function checkSecurity(ref){
  const snap=await ref.get();if(!snap.exists)return;
  const d=snap.data();let reason=null;
  if(d.deviceId&&d.deviceId!==deviceId)reason="Multi-device terdeteksi";
  if(d.ip&&d.ip!==userIp)reason="Multi-IP mencurigakan";
  if(reason){await ref.update({banned:true,reason});showNotif("üö´ Banned",reason);auth.signOut();}
}
</script>
</body>
</html>